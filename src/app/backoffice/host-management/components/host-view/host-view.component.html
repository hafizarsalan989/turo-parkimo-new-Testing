<div class="main-content">
  <div class="container-fluid">
    <div class="card">
      <div class="card-header">
        <div class="row align-items-center mt-3">
          <div class="col-md-4">
            <button mat-raised-button class="btn btn-info btn-link px-0" type="button" (click)="cancel()">
              <i class="material-icons">arrow_back</i> Back
            </button>
          </div>
          <div class="col-md-4">
            <h3 class="card-title text-center mt-0">Host Details</h3>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div *ngIf="owner?.verificationCode" class="alert alert-warning" role="alert">
          <div class="row align-items-center justify-content-between">
            <div class="col-auto">
              Host is not verified. Verification code is
              <strong>{{ owner.verificationCode }}</strong>
            </div>
            <div class="col-auto">
              <button mat-raised-button type="button" class="btn btn-danger" (click)="verifyEmail()">
                Verify
              </button>
            </div>
          </div>
        </div>
        <div role="tablist">
          <div class="card-collapse">
            <div class="card-header" role="tab" id="headingOne">
              <h5 class="mb-0">
                <a data-toggle="collapse" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne"
                  class="collapsed">
                  Information
                  <i class="material-icons">keyboard_arrow_down</i>
                </a>
              </h5>
            </div>
            <div id="collapseOne" class="collapse show" role="tabpanel" aria-labelledby="headingOne">
              <div class="card-body">
                <form [formGroup]="infoForm" (submit)="onSaveInfo()">
                  <div class="row mb-4">
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Company Name:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <input matInput type="text" formControlName="companyName" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Owner First Name:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <input matInput type="text" formControlName="firstname" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Owner Last Name:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <input matInput type="text" formControlName="lastname" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Owner Email:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <input matInput type="text" formControlName="email" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Owner Phone:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <input matInput type="text" formControlName="phone" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Rental Platform User Name:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <input matInput type="text" formControlName="rentalPlatformUsername" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Vehicle Count:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <input matInput type="number" formControlName="vehicleCount"
                              (keydown)="onVehicleCountKeydown($event)" (input)="onVehicleCountInput($event)" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Market:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <mat-select formControlName="market">
                              <mat-option *ngFor="let market of markets" [value]="market">
                                {{ market }}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Withdrawal Limit:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <span matPrefix>$</span>
                            <input matInput type="number" formControlName="withdrawalLimit" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Withdrawal Fee:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <span matPrefix>$</span>
                            <input matInput type="number" formControlName="withdrawalFee" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">Referral Percentage:</label>
                        <div class="col-md-8">
                          <mat-form-field>
                            <input matInput type="number" formControlName="referralPercentage" />
                            <span matSuffix>%</span>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-4 col-form-label">AutoWithdrawal:</label>
                        <div class="col-md-8 pt-3">
                          <mat-checkbox formControlName="autoWithdrawal"></mat-checkbox>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="row">
                        <label class="col-md-5 col-form-label">Billing Enabled:</label>
                        <div class="col-md-7 pt-3">
                          <mat-checkbox formControlName="pauseBilling"></mat-checkbox>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="row">
                        <label class="col-md-5 col-form-label">Allow Billback:</label>
                        <div class="col-md-7 pt-3">
                          <mat-checkbox formControlName="allowBillback"></mat-checkbox>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="row">
                        <label class="col-md-5 col-form-label">Allow Unlimited Addons:</label>
                        <div class="col-md-7 pt-3">
                          <mat-checkbox formControlName="allowAddOnUnlimited"></mat-checkbox>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="row">
                        <label class="col-md-7 col-form-label">Ignore Daily Parking PMCs Fee:</label>
                        <div class="col-md-5 pt-3">
                          <mat-checkbox formControlName="ignoreDailyParkingPMCSFee"></mat-checkbox>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="row">
                        <label class="col-md-5 col-form-label">Access Suspended:</label>
                        <div class="col-md-7 pt-3">
                          <mat-checkbox formControlName="suspended"></mat-checkbox>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="row">
                        <label class="col-md-5 col-form-label">Allow GuestRegistration:</label>
                        <div class="col-md-7 pt-3">
                          <mat-checkbox formControlName="allowGuestRegistration"></mat-checkbox>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="text-right">
                    <button *ngIf="!hasActiveCityPass" mat-raised-button type="button" class="btn btn-danger mr-2"
                      (click)="onDelete()">
                      Delete
                    </button>
                    <button mat-raised-button type="submit" class="btn btn-success" [disabled]="infoForm.invalid">
                      Update
                    </button>
                  </div>
                </form>
                <div class="row">
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header border-0 px-4 py-3">
                        <h6 class="mb-0">Primary Credit Card</h6>
                      </div>
                      <div class="card-body">
                        <h4 class="card-title text-center">
                          <ng-container *ngIf="primaryCard">
                            <img [src]="getIcon(primaryCard.cardType)" class="mr-1" /><span class="mr-3">{{
                              primaryCard.cardMask
                              }}</span>
                            <small>Exp: {{ primaryCard.cardExpiration }}</small>
                            <button mat-raised-button mat-min-fab
                              class="btn btn-success btn-link btn-round btn-fab btn-sm ml-3" title="Change"
                              (click)="addCreditCard(true)">
                              <i class="material-icons">edit</i>
                            </button>
                            <button *ngIf="!secondaryCard" mat-raised-button mat-min-fab
                              class="btn btn-danger btn-link btn-round btn-fab btn-sm" title="Delete Card"
                              (click)="deleteCardOnFile(primaryCard?.id)">
                              <i class="material-icons">delete</i>
                            </button>
                          </ng-container>
                          <ng-container *ngIf="!primaryCard">
                            <button mat-raised-button mat-min-fab class="btn btn-info my-0"
                              (click)="addCreditCard(true)">
                              <i class="material-icons">add</i>
                              Add
                            </button>
                            <i class="material-icons align-middle ml-3">credit_card</i>
                          </ng-container>
                        </h4>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card">
                      <div class="card-header border-0 px-4 py-3">
                        <h6 class="mb-0">Secondary Credit Card</h6>
                      </div>
                      <div class="card-body">
                        <h4 class="card-title text-center">
                          <ng-container *ngIf="secondaryCard">
                            <img [src]="getIcon(secondaryCard.cardType)" class="mr-1" /><span class="mr-3">{{
                              secondaryCard.cardMask
                              }}</span>
                            <small>Exp: {{ secondaryCard.cardExpiration }}</small>
                            <button mat-raised-button mat-min-fab
                              class="btn btn-info btn-link btn-round btn-fab btn-sm ml-3" title="Make Primary"
                              (click)="setToPrimary()">
                              <i class="material-icons">swap_vert</i>
                            </button>
                            <button mat-raised-button mat-min-fab
                              class="btn btn-danger btn-link btn-round btn-fab btn-sm" title="Delete Card"
                              (click)="deleteCardOnFile(secondaryCard?.id)">
                              <i class="material-icons">delete</i>
                            </button>
                          </ng-container>
                          <ng-container *ngIf="!secondaryCard">
                            <button mat-raised-button mat-min-fab class="btn btn-info my-0" (click)="addCreditCard()">
                              <i class="material-icons">add</i>
                              Add
                            </button>
                            <i class="material-icons align-middle ml-3">credit_card</i>
                          </ng-container>
                        </h4>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-collapse">
            <div class="card-header" role="tab" id="headingTwo">
              <h5 class="mb-0">
                <a class="collapsed" data-toggle="collapse" href="#collapseTwo" aria-expanded="false"
                  aria-controls="collapseTwo">
                  Addresses
                  <i class="material-icons">keyboard_arrow_down</i>
                </a>
              </h5>
            </div>
            <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo">
              <div class="card-body">
                <form [formGroup]="addressForm" (submit)="onSaveAddress()">
                  <h5 class="font-weight-normal">
                    Host Address
                    <i ngxClipboard [cbContent]="fullAddress(host)" class="material-icons ml-1 text-info clipboard"
                      title="Copy address">
                      content_copy
                    </i>
                  </h5>
                  <div formGroupName="address" class="row">
                    <div class="col-md-6">
                      <div class="row">
                        <label class="col-md-2 col-form-label">Address1:</label>
                        <div class="col-md-10">
                          <mat-form-field>
                            <input matInput formControlName="address1" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="row">
                        <label class="col-md-2 col-form-label">Address2:</label>
                        <div class="col-md-10">
                          <mat-form-field>
                            <input matInput formControlName="address2" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">City:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <input matInput formControlName="city" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">State:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <mat-select formControlName="state">
                              <mat-option *ngFor="let state of states" [value]="state.code">
                                {{ state.name }}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">Zip:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <input matInput formControlName="zip" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </div>

                  <h5 class="font-weight-normal">
                    Mailing Address
                    <i ngxClipboard [cbContent]="fullMailingAddress(host)"
                      class="material-icons ml-1 text-info clipboard" title="Copy shipping address">
                      content_copy
                    </i>
                  </h5>
                  <div formGroupName="mailingAddress" class="row">
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">Address1:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <input matInput formControlName="address1" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">Address2:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <input matInput formControlName="address2" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">Attention:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <input matInput formControlName="attention" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">City:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <input matInput formControlName="city" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">State:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <mat-select formControlName="state">
                              <mat-option *ngFor="let state of states" [value]="state.code">
                                {{ state.name }}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="row">
                        <label class="col-md-3 col-form-label">Zip:</label>
                        <div class="col-md-9">
                          <mat-form-field>
                            <input matInput formControlName="zip" type="text" />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="text-right">
                    <button mat-raised-button type="submit" class="btn btn-success" [disabled]="addressForm.invalid">
                      Update
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div class="card-collapse mb-4">
            <div class="card-header" role="tab" id="headingThree">
              <h5 class="mb-0">
                <a class="collapsed" data-toggle="collapse" href="#collapseThree" aria-expanded="false"
                  aria-controls="collapseThree">
                  Product Max Overrides
                  <i class="material-icons">keyboard_arrow_down</i>
                </a>
              </h5>
            </div>
            <div id="collapseThree" class="collapse" role="tabpanel" aria-labelledby="headingThree">
              <div class="card-body">
                <div class="text-right">
                  <button mat-raised-button type="button" class="btn btn-info" (click)="openProductMaxEditor()">
                    Add
                  </button>
                </div>
                <div class="table-responsive">
                  <table class="table">
                    <thead class="text-primary">
                      <tr>
                        <th>Facility</th>
                        <th>Product</th>
                        <th>Max</th>
                        <th style="width: 120px"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of productMaxOverrides">
                        <td>{{ item.facilityName }}</td>
                        <td>{{ item.product }}</td>
                        <td>{{ item.max | number }}</td>
                        <td class="td-actions">
                          <button mat-raised-button class="btn btn-info mx-1" type="button"
                            (click)="openProductMaxEditor(item)">
                            <i class="material-icons">edit</i>
                          </button>
                          <button mat-raised-button class="btn btn-danger mx-1" type="button"
                            (click)="removeProductMax(item)">
                            <i class="material-icons">close</i>
                          </button>
                        </td>
                      </tr>
                      <tr *ngIf="productMaxOverrides.length === 0">
                        <td [colSpan]="4" class="text-center">No data</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div class="card-collapse mb-4">
            <div class="card-header" role="tab" id="headingThree">
              <h5 class="mb-0">
                <a class="collapsed" data-toggle="collapse" href="#collapseFour" aria-expanded="false"
                  aria-controls="collapseFour">
                  Calculator
                  <i class="material-icons">keyboard_arrow_down</i>
                </a>
              </h5>
            </div>
            <div id="collapseFour" class="collapse" role="tabpanel" aria-labelledby="headingFour">
              <div class="card-body">
                <div class="text-left">
                  <!-- Show button only in 'host' mode -->
                  <button  mat-stroked-button color="primary" (click)="openFeeCalculator()"
                    type="button">
                    Delivery Fee Calculator
                  </button>
                </div>

              </div>
            </div>
          </div>
        </div>

        <div class="mt-3">
          <ul class="nav nav-pills nav-pills-warning" role="tablist">
            <li *ngFor="let t of tabs" class="nav-item" (click)="toggleTab(t.id)">
              <a class="nav-link" [ngClass]="{ active: tab === t.id }" data-toggle="tab" [href]="'#' + tab.id"
                role="tablist">
                {{ t.name }}
              </a>
            </li>
          </ul>
          <div class="tab-content tab-space">
            <div class="tab-pane" [ngClass]="{ active: tab === 'vehicle' }" id="vehicle">
              <app-vehicle-list-table *ngIf="tab === 'vehicle'" [companyId]="host?.id" [editable]="false"
                [filterCriteria]="filterCriteria"></app-vehicle-list-table>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'permit' }" id="permit">
              <app-permit-list-table *ngIf="tab === 'permit'" [companyId]="host?.id"></app-permit-list-table>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'reserved-space' }" id="reserved-space">
              <app-reserved-space-list-table *ngIf="tab === 'reserved-space'"
                [companyId]="host?.id"></app-reserved-space-list-table>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'tags' }" id="tags">
              <app-tag-list-table *ngIf="tab === 'tags'" [companyId]="host?.id"></app-tag-list-table>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'invoice' }" id="invoice">
              <app-invoice-list-table *ngIf="tab === 'invoice'" [companyId]="host?.id"></app-invoice-list-table>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'user' }" id="user">
              <app-user-list-table *ngIf="tab === 'user'" [companyId]="host?.id"></app-user-list-table>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'activity' }" id="activity">
              <app-session-list-table *ngIf="tab === 'activity'" [id]="host?.id"
                type="company"></app-session-list-table>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'fuel-tank' }" id="fuel-tank">
              <app-fuel-tank *ngIf="tab === 'fuel-tank'" [host]="host"></app-fuel-tank>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'traveler-invoices' }" id="traveler-invoices">
              <app-host-traveler-invoice *ngIf="tab === 'traveler-invoices'"
                [hostId]="host?.id"></app-host-traveler-invoice>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'notes' }" id="notes">
              <app-host-note-list-table *ngIf="tab === 'notes'" [companyId]="host?.id"></app-host-note-list-table>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'chase-cars' }" id="chase-cars">
              <app-chase-car *ngIf="tab === 'chase-cars'" [companyId]="host?.id"></app-chase-car>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'qr-code' }" id="qr-code">
              <app-qr-code *ngIf="tab === 'qr-code'" [company]="host"></app-qr-code>
            </div>
            <div class="tab-pane" [ngClass]="{ active: tab === 'referral-list' }" id="referral-list">
              <!-- <app-referral-list *ngIf="tab === 'referel-link'" [company]="host"></app-referral-list> -->
               <app-referral-list *ngIf="tab === 'referral-list'" [companyId]="companyId"></app-referral-list>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-credit-card-modal *ngIf="creditCardModalId" [modalId]="creditCardModalId" [gateway]="gateway"
  (saved)="saveCardOnFile($event)" (canceled)="creditCardModalId = ''"></app-credit-card-modal>

<div class="modal fade" id="productMaxOverrideModal" tabindex="-1" role="dialog"
  aria-labelledby="productMaxOverrideModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" [formGroup]="productMaxForm" (submit)="saveProductMax()">
      <div class="modal-header">
        <h4 class="modal-title">Product Max Editor</h4>
        <button mat-button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          <i class="material-icons">clear</i>
        </button>
      </div>
      <div class="modal-body">
        <mat-form-field>
          <mat-label>Facility</mat-label>
          <mat-select formControlName="facilityId">
            <mat-option *ngFor="let facility of facilities" [value]="facility.id">
              {{ facility.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="productMaxForm.get('facilityId').hasError('required')">
            Facility is <strong>required</strong>
          </mat-error>
        </mat-form-field>
        <mat-form-field>
          <mat-label>Product</mat-label>
          <mat-select formControlName="product">
            <mat-option *ngFor="let product of ['Unlimited', 'Subscription', 'Reserved']" [value]="product">
              {{ product }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="productMaxForm.get('product').hasError('required')">
            Product is <strong>required</strong>
          </mat-error>
        </mat-form-field>
        <mat-form-field>
          <mat-label>Max</mat-label>
          <input matInput type="number" formControlName="max" />
          <mat-error *ngIf="productMaxForm.get('max').hasError('required')">
            Max is <strong>required</strong>
          </mat-error>
          <mat-error *ngIf="productMaxForm.get('max').hasError('min')">
            Max should be greater than <strong>0</strong>
          </mat-error>
        </mat-form-field>
      </div>
      <div class="modal-footer">
        <button mat-raised-button type="button" class="btn btn-danger mr-2" data-dismiss="modal">
          Cancel
        </button>
        <button mat-raised-button type="submit" class="btn btn-success">
          Save
        </button>
      </div>
    </form>
  </div>
</div>